#
# Apache vhost config file for openleaf.co.nz
#

Define SITENAME	"release.openleaf.co.nz"
Define SITEALIAS "r.openleaf.co.nz"
Define SITENUM "112"
Define SITETYPE "master"
Define SITEPATH "/data/www/openleaf-co-nz/htdocs/master"
Define FPMSHOW
Define FPMALLOWIP "203.86.201.118"
Define ALLOWEDIP "203.86.201.118"

#live
<VirtualHost *:80>
        ServerName ${SITENAME}
        ServerAlias ${SITEALIAS}
	#ServerAdmin webmaster@openleaf.net.nz

	LogLevel warn
        ErrorLog	/data/logs/apache/${SITENUM}-${SITETYPE}-error.log
        CustomLog	/data/logs/apache/${SITENUM}-${SITETYPE}-access.log combined

        DocumentRoot	${SITEPATH}

        <IfModule mod_proxy_fcgi.c>
		<IfDefine FPMSHOW>
                	<LocationMatch "^/fpm/(ping|status)">
                                Require ip 127.0.0.1 ${FPMALLOWIP}
				ProxyPassMatch fcgi://127.0.0.1:9${SITENUM}/$1
                	</LocationMatch>
		</IfDefine>

                #ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9${SITENUM}${SITEPATH}/$1
		ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9${SITENUM}${SITEPATH}/$1
        </IfModule>

        <Directory ${SITEPATH}>
                Options +FollowSymLinks
		AllowOverride All
                <RequireAll>
                        Require all granted
                        Require not env BadBot
                </RequireAll>

                # Statamic htaccess rules
                Include conf-available/htaccess-statamic.conf

        </Directory>
</VirtualHost>
