#
# Apache vhost config file for openleaf.co.nz
#

Define SITENAME	"openleaf.co.nz"
Define SITEALIAS "ddd.openleaf.co.nz"
Define SITENUM "111"
Define SITETYPE "live"
Define SITEPATH "/data/www/openleaf-co-nz/htdocs/tagged"
Define FPMSHOW
Define FPMALLOWIP "203.86.201.118"

#live
<VirtualHost *:80>
        ServerName ${SITENAME}
        ServerAlias ${SITEALIAS}
	#ServerAdmin webmaster@openleaf.net.nz

	LogLevel warn
        ErrorLog	/data/logs/apache/${SITENUM}-${SITETYPE}-error.log
        CustomLog	/data/logs/apache/${SITENUM}-${SITETYPE}-access.log combined

        DocumentRoot	${SITEPATH}

        <IfModule mod_proxy_fcgi.c>
		<IfDefine FPMSHOW>
                	<LocationMatch "^/fpm/(ping|status)">
                                Require ip 127.0.0.1 ${FPMALLOWIP}
				ProxyPassMatch fcgi://127.0.0.1:9${SITENUM}/$1
                	</LocationMatch>
		</IfDefine>
		ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9${SITENUM}${SITEPATH}/$1
        </IfModule>

        <Directory ${SITEPATH}>
                Options -Indexes +FollowSymLinks
		<RequireAll>
                	Require all granted
			Require not env BadBot
		</RequireAll>
        </Directory>

</VirtualHost>

#redirects
<VirtualHost *:80>
        ServerName www.openleaf.co.nz
        ServerAlias www.openleaf.net.nz openleaf.net.nz
	#Redirect permanent / http://openleaf.co.nz/
        Redirect permanent / http://ddd.openleaf.co.nz/
</VirtualHost>
